
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nglview.widget &#8212; NGLView 2.7.7+0.gd41dfb9.dirty documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NGLView 2.7.7+0.gd41dfb9.dirty documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">nglview.widget</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for nglview.widget</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">ipywidgets.embed</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Image</span><span class="p">,</span> <span class="n">Box</span><span class="p">,</span> <span class="n">DOMWidget</span><span class="p">,</span> <span class="n">HBox</span><span class="p">,</span> <span class="n">VBox</span><span class="p">,</span> <span class="n">IntSlider</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">Play</span><span class="p">,</span> <span class="n">Widget</span><span class="p">,</span>
                        <span class="n">jslink</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">widget</span> <span class="k">as</span> <span class="n">_widget</span>
<span class="kn">from</span> <span class="nn">traitlets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Bool</span><span class="p">,</span> <span class="n">CaselessStrEnum</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span>
                       <span class="n">List</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">observe</span><span class="p">,</span> <span class="n">validate</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">traitlets</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">color</span><span class="p">,</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">.adaptor</span> <span class="kn">import</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Trajectory</span>
<span class="kn">from</span> <span class="nn">.component</span> <span class="kn">import</span> <span class="n">ComponentViewer</span>
<span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="n">BACKENDS</span>
<span class="kn">from</span> <span class="nn">.player</span> <span class="kn">import</span> <span class="n">TrajectoryPlayer</span><span class="p">,</span> <span class="n">_dry_run</span>
<span class="kn">from</span> <span class="nn">.remote_thread</span> <span class="kn">import</span> <span class="n">RemoteCallThread</span>
<span class="kn">from</span> <span class="nn">.representation</span> <span class="kn">import</span> <span class="n">RepresentationControl</span>
<span class="kn">from</span> <span class="nn">.shape</span> <span class="kn">import</span> <span class="n">Shape</span>
<span class="kn">from</span> <span class="nn">.stage</span> <span class="kn">import</span> <span class="n">Stage</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">py_utils</span><span class="p">,</span> <span class="n">widget_utils</span>
<span class="kn">from</span> <span class="nn">.utils.py_utils</span> <span class="kn">import</span> <span class="p">(</span><span class="n">FileManager</span><span class="p">,</span> <span class="n">_camelize_dict</span><span class="p">,</span> <span class="n">_update_url</span><span class="p">,</span>
                             <span class="n">encode_base64</span><span class="p">,</span> <span class="n">get_repr_names_from_dict</span><span class="p">,</span>
                             <span class="n">seq_to_string</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.viewer_control</span> <span class="kn">import</span> <span class="n">ViewerControl</span>
<span class="kn">from</span> <span class="nn">._frontend</span> <span class="kn">import</span> <span class="n">__frontend_version__</span>
<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">BaseWidget</span>

<span class="n">widget_serialization</span> <span class="o">=</span> <span class="n">_widget</span><span class="o">.</span><span class="n">widget_serialization</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NGLWidget&#39;</span><span class="p">,</span> <span class="s1">&#39;ComponentViewer&#39;</span><span class="p">]</span>
<span class="n">_EXCLUDED_CALLBACK_AFTER_FIRING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;setUnSyncCamera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;setSelector&#39;</span><span class="p">,</span>
    <span class="s1">&#39;setDelay&#39;</span><span class="p">,</span>
    <span class="s1">&#39;autoView&#39;</span><span class="p">,</span>
    <span class="s1">&#39;_downloadImage&#39;</span><span class="p">,</span>
    <span class="s1">&#39;_exportImage&#39;</span><span class="p">,</span>
    <span class="s1">&#39;set_representation_from_backend&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">_deprecated</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrap_1</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrap_2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrap_2</span>

    <span class="k">return</span> <span class="n">wrap_1</span>


<div class="viewcode-block" id="write_html"><a class="viewcode-back" href="../../api.html#nglview.widget.write_html">[docs]</a><span class="k">def</span> <span class="nf">write_html</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">views</span><span class="p">,</span> <span class="n">frame_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># type: (str, List[NGLWidget]) -&gt; None</span>
    <span class="sd">&quot;&quot;&quot;EXPERIMENTAL. Likely will be changed.</span>

<span class="sd">    Make html file to display a list of views. For further options, please</span>
<span class="sd">    check `ipywidgets.embed` module.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fp : str or file handle</span>
<span class="sd">    views : a DOMWidget view or a list of views.</span>
<span class="sd">    frame_range : None or a tuple of int</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import nglview</span>
<span class="sd">    &gt;&gt;&gt; view = nglview.show_pdbid(&#39;1tsu&#39;)</span>
<span class="sd">    &gt;&gt;&gt; view # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; nglview.write_html(&#39;index.html&#39;, [view]) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; nglview.write_html(&#39;index.html&#39;, [view], frame_range=(0, 5)) # doctest: +SKIP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">views</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="n">DOMWidget</span><span class="p">)</span> <span class="ow">and</span> <span class="p">[</span><span class="n">views</span><span class="p">]</span> <span class="ow">or</span> <span class="n">views</span>
    <span class="n">embed</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">embed</span>
    <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">views</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;_ColormakerRegistry&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;ThemeManager&#39;</span><span class="p">:</span>
            <span class="n">theme</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="n">color</span><span class="p">,</span> <span class="n">theme</span><span class="p">]:</span>
        <span class="n">v</span> <span class="ow">and</span> <span class="n">views</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_serialization</span><span class="p">(</span><span class="n">views</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="s1">&#39;_set_serialization&#39;</span><span class="p">):</span>
                <span class="n">view</span><span class="o">.</span><span class="n">_set_serialization</span><span class="p">(</span><span class="n">frame_range</span><span class="o">=</span><span class="n">frame_range</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">_set_serialization</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unset_serialization</span><span class="p">(</span><span class="n">views</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="s1">&#39;_unset_serialization&#39;</span><span class="p">):</span>
                <span class="n">view</span><span class="o">.</span><span class="n">_unset_serialization</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">_unset_serialization</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>

    <span class="n">_set_serialization</span><span class="p">(</span><span class="n">views</span><span class="p">)</span>
    <span class="c1"># FIXME: allow add jquery-ui link?</span>
    <span class="n">snippet</span> <span class="o">=</span> <span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.0/jquery-ui.css&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">snippet</span> <span class="o">+=</span> <span class="n">embed</span><span class="o">.</span><span class="n">embed_snippet</span><span class="p">(</span><span class="n">views</span><span class="p">)</span>
    <span class="n">html_code</span> <span class="o">=</span> <span class="n">embed</span><span class="o">.</span><span class="n">html_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;nglview-demo&#39;</span><span class="p">,</span>
                                           <span class="n">snippet</span><span class="o">=</span><span class="n">snippet</span><span class="p">)</span>

    <span class="c1"># from ipywidgets</span>
    <span class="c1"># Check if fp is writable:</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">):</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_code</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Assume fp is a filename:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_code</span><span class="p">)</span>

    <span class="n">_unset_serialization</span><span class="p">(</span><span class="n">views</span><span class="p">)</span></div>



<div class="viewcode-block" id="NGLWidget"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget">[docs]</a><span class="k">class</span> <span class="nc">NGLWidget</span><span class="p">(</span><span class="n">DOMWidget</span><span class="p">):</span>
    <span class="n">_view_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;NGLView&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_view_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;nglview-js-widgets&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_view_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">__frontend_version__</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_model_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;NGLModel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_model_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;nglview-js-widgets&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_model_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">__frontend_version__</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_ngl_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># _model_name = Unicode(&quot;NGLView&quot;).tag(sync=True)</span>
    <span class="c1"># _model_module = Unicode(&quot;nglview-js-widgets&quot;).tag(sync=True)</span>
    <span class="n">_image_data</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># use Integer here, because mdtraj uses a long datatype here on Python-2.7</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">max_frame</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">background</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">loaded</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">picked</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n_components</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_view_width</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># px</span>
    <span class="n">_view_height</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># px</span>
    <span class="n">_scene_position</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_scene_rotation</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># hack to always display movie</span>
    <span class="c1"># TODO: remove _parameters?</span>
    <span class="n">_parameters</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">_ngl_full_stage_parameters</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_ngl_original_stage_parameters</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_coordinates_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">_camera_str</span> <span class="o">=</span> <span class="n">CaselessStrEnum</span><span class="p">([</span><span class="s1">&#39;perspective&#39;</span><span class="p">,</span> <span class="s1">&#39;orthographic&#39;</span><span class="p">],</span>
                                  <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;orthographic&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_camera_orientation</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_synced_model_ids</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_synced_repr_model_ids</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_ngl_view_id</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_ngl_repr_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_ngl_component_ids</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">_ngl_component_names</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">_ngl_msg</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_send_binary</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">_init_gui</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gui_style</span> <span class="o">=</span> <span class="n">CaselessStrEnum</span><span class="p">([</span><span class="s1">&#39;ngl&#39;</span><span class="p">],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_gui_theme</span> <span class="o">=</span> <span class="n">CaselessStrEnum</span><span class="p">([</span><span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="s1">&#39;light&#39;</span><span class="p">],</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_widget_theme</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_ngl_serialize</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_ngl_msg_archive</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_ngl_coordinate_resource</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_representations</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">_ngl_color_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_player_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># instance</span>
    <span class="n">_iplayer</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span>
                        <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">widget_serialization</span><span class="p">)</span>
    <span class="n">_igui</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">,</span>
                     <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">widget_serialization</span><span class="p">)</span>
    <span class="n">_ibtn_fullscreen</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span>
            <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">widget_serialization</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">representations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gui</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_gui</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gui&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_theme</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;theme&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_widget_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_widget_image</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">900.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># do not use _displayed_callbacks since there is another Widget._display_callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_displayed_callbacks_before_loaded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">widget_utils</span><span class="o">.</span><span class="n">_add_repr_method_shortcut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span> <span class="o">=</span> <span class="n">Stage</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">ViewerControl</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_msg_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_msg</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_handle_msg</span><span class="p">,</span> <span class="p">))</span>
        <span class="c1"># # register to get data from JS side</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_msg_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_msg_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call_thread</span> <span class="o">=</span> <span class="n">RemoteCallThread</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">registered_funcs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;loadFile&#39;</span><span class="p">,</span> <span class="s1">&#39;replaceStructure&#39;</span><span class="p">,</span> <span class="s1">&#39;_exportImage&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">representations</span><span class="p">:</span>
            <span class="c1"># Must be set here before calling</span>
            <span class="c1"># add_trajectory or add_struture</span>
            <span class="c1"># After finish adding new Structure/Trajectory,</span>
            <span class="c1"># initial representations will be set.</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;default_representation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;default&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;default_representation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>

        <span class="n">autoview</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;center&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span>
                                              <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">))</span>
        <span class="c1"># NOTE: Using `pop` to avoid passing `center` to NGL.</span>

        <span class="k">if</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">Trajectory</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_trajectory</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">trajectories</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="k">for</span> <span class="n">trajectory</span> <span class="ow">in</span> <span class="n">trajectories</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_trajectory</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">representations</span><span class="p">:</span>
            <span class="c1"># If initial representations are provided,</span>
            <span class="c1"># we need to set defaultRepresentation to False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">representations</span> <span class="o">=</span> <span class="n">representations</span>
            <span class="k">if</span> <span class="n">autoview</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">TrajectoryPlayer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Updating only self.layout.{width, height} don&#39;t handle</span>
        <span class="c1"># resizing NGL widget properly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_with_layout</span><span class="p">()</span>
        <span class="c1"># self.layout.width = &#39;auto&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_player</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_ibtn_fullscreen</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_ibtn_fullscreen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="s1">&#39;compress&#39;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;34px&#39;</span>
        <span class="c1"># onclick is implemented in frontend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ibtn_fullscreen</span> <span class="o">=</span> <span class="n">button</span>


    <span class="k">def</span> <span class="nf">_sync_with_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">on_change_layout</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_size</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_size</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">on_change_layout</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_serialization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_serialize</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_coordinate_resource</span>
        <span class="k">if</span> <span class="n">frame_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t_index</span><span class="p">,</span> <span class="n">traj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">):</span>
                <span class="n">resource</span><span class="p">[</span><span class="n">t_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">f_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">frame_range</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">f_index</span> <span class="o">&lt;</span> <span class="n">traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">:</span>
                        <span class="n">resource</span><span class="p">[</span><span class="n">t_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">encode_base64</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span><span class="n">f_index</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">resource</span><span class="p">[</span><span class="n">t_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">encode_base64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f4&#39;</span><span class="p">)))</span>
            <span class="n">resource</span><span class="p">[</span><span class="s1">&#39;n_frames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_coordinate_resource</span> <span class="o">=</span> <span class="n">resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_color_dict</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">_USER_COLOR_DICT</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_player</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">player</span> <span class="o">=</span> <span class="n">Play</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frame</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="n">IntSlider</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iplayer</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">([</span><span class="n">player</span><span class="p">,</span> <span class="n">slider</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_player</span> <span class="o">=</span> <span class="n">player</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_player_slider</span> <span class="o">=</span> <span class="n">slider</span>

        <span class="n">jslink</span><span class="p">((</span><span class="n">player</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="n">jslink</span><span class="p">((</span><span class="n">player</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;frame&#39;</span><span class="p">))</span>
        <span class="n">jslink</span><span class="p">((</span><span class="n">player</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;max_frame&#39;</span><span class="p">))</span>
        <span class="n">jslink</span><span class="p">((</span><span class="n">slider</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;max_frame&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_unset_serialization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_serialize</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_coordinate_resource</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">_camelize_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;setParameters&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span>
            <span class="n">params</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">camera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_str</span>

    <span class="nd">@camera</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str, {&#39;perspective&#39;, &#39;orthographic&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_camera_str</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># use _remote_call so this function can be called right after</span>
        <span class="c1"># self is displayed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setParameters&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Stage&#39;</span><span class="p">,</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">cameraType</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_camera_str</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_camera_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;set_camera_orientation&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                              <span class="n">arr</span><span class="p">,</span>
                          <span class="p">])</span>

    <span class="k">def</span> <span class="nf">_request_stage_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;requestUpdateStageParameters&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">)</span>

    <span class="nd">@validate</span><span class="p">(</span><span class="s1">&#39;gui_style&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_validate_gui_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposal</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s1">&#39;ngl&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_theme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">.theme</span> <span class="kn">import</span> <span class="n">ThemeManager</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_widget_theme</span> <span class="o">=</span> <span class="n">ThemeManager</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widget_theme</span><span class="o">.</span><span class="n">_theme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_widget_theme</span><span class="o">.</span><span class="n">light</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s2">&quot;_gui_theme&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_on_theme_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="c1"># EXPERIMENTAL</span>
        <span class="kn">from</span> <span class="nn">nglview.theme</span> <span class="kn">import</span> <span class="n">theme</span>
        <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_widget_theme</span><span class="o">.</span><span class="n">dark</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span> <span class="o">==</span> <span class="s1">&#39;light&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_widget_theme</span><span class="o">.</span><span class="n">light</span><span class="p">()</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;picked&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_on_picked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">picked</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_picked</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_picked</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">picked</span><span class="p">)</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_background_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.handle_resize"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.handle_resize">[docs]</a>    <span class="k">def</span> <span class="nf">handle_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self._remote_call(&quot;handleResize&quot;, target=&#39;Stage&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;handleResize&quot;</span><span class="p">)</span></div>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;n_components&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_handle_n_components_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">component_slider</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;component_slider&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">component_slider</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
                <span class="n">component_slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">component_dropdown</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;component_dropdown&#39;</span><span class="p">)</span>
            <span class="n">component_dropdown</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_names</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">component_dropdown</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="s1">&#39; &#39;</span><span class="p">])</span>
                <span class="n">component_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

                <span class="n">component_slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">reprlist_choices</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;reprlist_choices&#39;</span><span class="p">)</span>
                <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="s1">&#39; &#39;</span><span class="p">])</span>

                <span class="n">repr_slider</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_slider&#39;</span><span class="p">)</span>
                <span class="n">repr_slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">repr_name_text</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_name_text&#39;</span><span class="p">)</span>
                <span class="n">repr_selection</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_selection&#39;</span><span class="p">)</span>
                <span class="n">repr_name_text</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                <span class="n">repr_selection</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;_ngl_repr_dict&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_handle_repr_dict_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">repr_slider</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_slider&#39;</span><span class="p">)</span>
            <span class="n">component_slider</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;component_slider&#39;</span><span class="p">)</span>
            <span class="n">repr_name_text</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_name_text&#39;</span><span class="p">)</span>
            <span class="n">repr_selection</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_selection&#39;</span><span class="p">)</span>
            <span class="n">reprlist_choices</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;reprlist_choices&#39;</span><span class="p">)</span>
            <span class="n">repr_names</span> <span class="o">=</span> <span class="n">get_repr_names_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_repr_dict</span><span class="p">,</span>
                                                  <span class="n">component_slider</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{}}:</span>
                <span class="n">repr_selection</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">repr_names</span><span class="p">))</span>
                <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">repr_slider</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="c1"># https://github.com/jupyter-widgets/ipywidgets/issues/1512</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">repr_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># works fine with ipywidgets 5.2.2</span>
                        <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span>
                            <span class="s1">&#39; &#39;</span><span class="p">,</span>
                        <span class="p">])</span>
                        <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">options</span><span class="p">[</span>
                            <span class="n">repr_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                <span class="c1"># e.g: 0-cartoon</span>
                <span class="n">repr_name_text</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">reprlist_choices</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                    <span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="n">repr_slider</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">repr_names</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">repr_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_max_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_frame</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">n_frames</span><span class="p">)</span> <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="s1">&#39;n_frames&#39;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># index starts from 0</span>

    <span class="k">def</span> <span class="nf">_wait_until_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">):</span>
        <span class="c1"># NGL need to send &#39;finished&#39; signal to</span>
        <span class="c1"># backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># idle to make room for waiting for</span>
            <span class="c1"># &quot;finished&quot; event sent from JS</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="c1"># if event is set from another thread</span>
                <span class="c1"># break while True</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">_run_on_another_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1"># use `event` to singal</span>
        <span class="c1"># func(*args)</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">thread</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;loaded&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="c1"># trick for firefox on Linux</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fire_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_displayed_callbacks_before_loaded</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fire_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callback</span><span class="o">.</span><span class="n">_method_name</span> <span class="o">==</span> <span class="s1">&#39;loadFile&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_wait_until_finished</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_run_on_another_thread</span><span class="p">(</span><span class="n">_call</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_ipython_display_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_gui</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gui</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">_display</span><span class="p">()</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gui</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.display"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.display">[docs]</a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;ngl&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gui : bool</span>
<span class="sd">            If True: turn on GUI</span>
<span class="sd">        style : str, {&#39;ngl&#39;, &#39;ipywidgets}, default &#39;ngl&#39;</span>
<span class="sd">            GUI style (with gui=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gui</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;ipywidgets&#39;</span><span class="p">:</span>
                <span class="c1"># For the old implementation</span>
                <span class="c1"># is there anyone using this?</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui_style</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># turn off the NGL&#39;s GUI</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">_display</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gui</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">align_self</span> <span class="o">=</span> <span class="s1">&#39;stretch&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gui</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;400px&#39;</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gui</span><span class="p">])</span>
                <span class="k">def</span> <span class="nf">on</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">handle_resize</span><span class="p">()</span>
                <span class="n">b</span><span class="o">.</span><span class="n">on_displayed</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">b</span>
            <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;ngl&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui_style</span> <span class="o">=</span> <span class="s1">&#39;ngl&#39;</span>
                <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w, h : float or str</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import nglview; view = nglview.demo()</span>
<span class="sd">        &gt;&gt;&gt; view._set_size(100, 100)</span>
<span class="sd">        &gt;&gt;&gt; view._set_size(&#39;100px&#39;, &#39;100px&#39;)</span>
<span class="sd">        &gt;&gt;&gt; view._set_size(&#39;50%&#39;, &#39;50%&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;setSize&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_sync_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_views</span><span class="p">):</span>
        <span class="n">model_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="o">.</span><span class="n">_model_id</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other_views</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synced_repr_model_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_repr_model_ids</span><span class="p">)</span> <span class="o">|</span> <span class="n">model_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setSyncRepr&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_repr_model_ids</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_unsync_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_views</span><span class="p">):</span>
        <span class="n">model_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="o">.</span><span class="n">_model_id</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other_views</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synced_repr_model_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_repr_model_ids</span><span class="p">)</span> <span class="o">-</span> <span class="n">model_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setSyncRepr&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_repr_model_ids</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_sync_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_views</span><span class="p">):</span>
        <span class="n">model_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="o">.</span><span class="n">_model_id</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other_views</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synced_model_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_model_ids</span><span class="p">)</span> <span class="o">|</span> <span class="n">model_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setSyncCamera&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_model_ids</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_unsync_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_views</span><span class="p">):</span>
        <span class="n">model_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="o">.</span><span class="n">_model_id</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other_views</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_synced_model_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_model_ids</span><span class="p">)</span> <span class="o">-</span> <span class="n">model_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setSyncCamera&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_synced_model_ids</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_spin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;setSpin&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Stage&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">repr_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setSelection&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Representation&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">selection</span><span class="p">],</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">component_index</span><span class="o">=</span><span class="n">component</span><span class="p">,</span>
                                      <span class="n">repr_index</span><span class="o">=</span><span class="n">repr_index</span><span class="p">))</span>

<div class="viewcode-block" id="NGLWidget.color_by"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.color_by">[docs]</a>    <span class="k">def</span> <span class="nf">color_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color_scheme</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;update color for all representations of given component</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Unstable feature</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color_scheme : str</span>
<span class="sd">        component : int, default 0</span>
<span class="sd">            component index</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import nglview</span>
<span class="sd">        &gt;&gt;&gt; view = nglview.demo()</span>
<span class="sd">        &gt;&gt;&gt; # component 0</span>
<span class="sd">        &gt;&gt;&gt; view.color_by(&#39;atomindex&#39;)</span>

<span class="sd">        &gt;&gt;&gt; # component 1</span>
<span class="sd">        &gt;&gt;&gt; view.color_by(&#39;atomindex&#39;, component=1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">repr_names</span> <span class="o">=</span> <span class="n">get_repr_names_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_repr_dict</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">repr_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_representation</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span>
                                       <span class="n">repr_index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                                       <span class="n">color_scheme</span><span class="o">=</span><span class="n">color_scheme</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">representations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_representations</span>

    <span class="nd">@representations</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">representations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reps</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reps</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;_set_representation_from_repr_dict&quot;</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">reps</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_representations</span> <span class="o">=</span> <span class="n">reps</span><span class="p">[:]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_representations</span><span class="p">(</span><span class="n">reps</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.update_representation"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.update_representation">[docs]</a>    <span class="k">def</span> <span class="nf">update_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">repr_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        component : int, default 0</span>
<span class="sd">            component index</span>
<span class="sd">        repr_index : int, default 0</span>
<span class="sd">            representation index for given component</span>
<span class="sd">        parameters : dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">_camelize_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">component_index</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">repr_index</span><span class="o">=</span><span class="n">repr_index</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;setParameters&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Representation&#39;</span><span class="p">,</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_repr_dict</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_update_repr_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Send a request to fronend to send representation parameters</span>
<span class="sd">        back.</span>

<span class="sd">        # TODO: sync or async</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;request_repr_dict&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.set_representations"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.set_representations">[docs]</a>    <span class="k">def</span> <span class="nf">set_representations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">representations</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        representations : list of dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_representations</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">representations</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s1">&#39;params must be a dict&#39;</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;component_index&#39;</span><span class="p">:</span> <span class="n">component</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;addRepresentation&#39;</span><span class="p">,</span>
                              <span class="n">target</span><span class="o">=</span><span class="s1">&#39;compList&#39;</span><span class="p">,</span>
                              <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                                  <span class="n">params</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                              <span class="p">],</span>
                              <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_remove_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">repr_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;removeRepresentation&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">component</span><span class="p">,</span> <span class="n">repr_index</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_remove_representations_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repr_name</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;removeRepresentationsByName&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">repr_name</span><span class="p">,</span> <span class="n">component</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_update_representations_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repr_name</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">_camelize_dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;updateRepresentationsByName&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">repr_name</span><span class="p">,</span> <span class="n">component</span><span class="p">],</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_display_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">repr_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">repr_index</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_repr_dict</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">RepresentationControl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">repr_index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">movie_making</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">render_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># FIXME: use movie_making here seems awkward.</span>
        <span class="sd">&#39;&#39;&#39;update coordinates for all trajectories at index-th frame</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">render_params</span> <span class="o">=</span> <span class="n">render_params</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">:</span>
            <span class="n">coordinates_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">trajectory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">:</span>
                <span class="n">traj_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">shown</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">interpolate</span><span class="p">:</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">iparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                            <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">iparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">coordinates_dict</span><span class="p">[</span><span class="n">traj_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span>
                                <span class="n">index</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">traj</span><span class="o">=</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">coordinates_dict</span><span class="p">[</span>
                                <span class="n">traj_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">coordinates_dict</span><span class="p">[</span><span class="n">traj_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">),</span>
                                                                <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f4&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="n">coordinates_dict</span><span class="p">[</span><span class="n">traj_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f4&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">(</span><span class="n">coordinates_dict</span><span class="p">,</span>
                    <span class="n">render_params</span><span class="o">=</span><span class="n">render_params</span><span class="p">,</span>
                    <span class="n">movie_making</span><span class="o">=</span><span class="n">movie_making</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no trajectory available&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.set_coordinates"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.set_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">set_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr_dict</span><span class="p">,</span> <span class="n">movie_making</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">render_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># type: (Dict[int, np.ndarray]) -&gt; None</span>
        <span class="sd">&quot;&quot;&quot;Used for update coordinates of a given trajectory</span>
<span class="sd">        &gt;&gt;&gt; # arr: numpy array, ndim=2</span>
<span class="sd">        &gt;&gt;&gt; # update coordinates of 1st trajectory</span>
<span class="sd">        &gt;&gt;&gt; view.set_coordinates({0: arr})# doctest: +SKIP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">render_params</span> <span class="o">=</span> <span class="n">render_params</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates_dict</span> <span class="o">=</span> <span class="n">arr_dict</span>

        <span class="n">buffers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">coordinates_meta</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">buffers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;f4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
            <span class="n">coordinates_meta</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;binary_single&#39;</span><span class="p">,</span>
                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">coordinates_meta</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="n">movie_making</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;movie_making&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">movie_making</span>
            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;render_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">render_params</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">,</span>
            <span class="n">buffers</span><span class="o">=</span><span class="n">buffers</span><span class="p">)</span></div>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;frame&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_on_frame_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set and send coordinates at current frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.clear"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;shortcut of `clear_representations`</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_representations</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NGLWidget.clear_representations"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.clear_representations">[docs]</a>    <span class="k">def</span> <span class="nf">clear_representations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;clear all representations for given component</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        component : int, default 0 (first model)</span>
<span class="sd">            You need to keep track how many components you added.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;removeAllRepresentations&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;compList&#39;</span><span class="p">,</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;component_index&#39;</span><span class="p">:</span> <span class="n">component</span><span class="p">})</span></div>

    <span class="nd">@_update_url</span>
    <span class="k">def</span> <span class="nf">_add_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;shape&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;add shape objects</span>

<span class="sd">        TODO: update doc, caseless shape keyword</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shapes : list of tuple</span>
<span class="sd">        name : str, default &#39;shape&#39;</span>
<span class="sd">            name of given shape</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Supported shape: &#39;mesh&#39;, &#39;sphere&#39;, &#39;ellipsoid&#39;, &#39;cylinder&#39;, &#39;cone&#39;, &#39;arrow&#39;.</span>
<span class="sd">        </span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        {ngl_url}</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import nglview</span>
<span class="sd">        &gt;&gt;&gt; view = nglview.demo()</span>
<span class="sd">        &gt;&gt;&gt; sphere = (&#39;sphere&#39;, [0, 0, 9], [1, 0, 0], 1.5)</span>
<span class="sd">        &gt;&gt;&gt; arrow = (&#39;arrow&#39;, [1, 2, 7 ], [30, 3, 3], [1, 0, 1], 1.0)</span>
<span class="sd">        &gt;&gt;&gt; c = view._add_shape([sphere, arrow], name=&#39;my_shape&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;addShape&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">shapes</span><span class="p">],</span> <span class="n">fire_embed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Added to remain in sync with the JS components</span>
        <span class="c1"># Similarly to _loadData</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

        <span class="n">comp_name</span> <span class="o">=</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_component_auto_completion</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ComponentViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.add_representation"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.add_representation">[docs]</a>    <span class="nd">@_update_url</span>
    <span class="k">def</span> <span class="nf">add_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repr_type</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add structure representation (cartoon, licorice, ...) for given atom selection.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        repr_type : str</span>
<span class="sd">            type of representation. Please see {ngl_url} for further info.</span>
<span class="sd">        selection : str or 1D array (atom indices) or any iterator that returns integer, default &#39;all&#39;</span>
<span class="sd">            atom selection</span>
<span class="sd">        **kwargs: additional arguments for representation</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import nglview as nv</span>
<span class="sd">        &gt;&gt;&gt; import pytraj </span>
<span class="sd">        &gt;&gt;&gt; t = pytraj.datafiles.load_tz2()</span>
<span class="sd">        &gt;&gt;&gt; w = nv.show_pytraj(t)</span>
<span class="sd">        &gt;&gt;&gt; w.add_representation(&#39;cartoon&#39;, selection=&#39;protein&#39;, color=&#39;blue&#39;)</span>
<span class="sd">        &gt;&gt;&gt; w.add_representation(&#39;licorice&#39;, selection=[3, 8, 9, 11], color=&#39;red&#39;)</span>
<span class="sd">        &gt;&gt;&gt; w # doctest: +SKIP</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        User can also use shortcut</span>

<span class="sd">        &gt;&gt;&gt; selection = &#39;protein&#39;</span>
<span class="sd">        &gt;&gt;&gt; w.add_cartoon(selection) # w.add_representation(&#39;cartoon&#39;, selection)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">repr_type</span> <span class="o">==</span> <span class="s1">&#39;surface&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;useWorker&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;useWorker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># avoid space sensitivity</span>
        <span class="n">repr_type</span> <span class="o">=</span> <span class="n">repr_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># overwrite selection</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">seq_to_string</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># make copy</span>
        <span class="n">kwargs2</span> <span class="o">=</span> <span class="n">_camelize_dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;component&#39;</span> <span class="ow">in</span> <span class="n">kwargs2</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="n">kwargs2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;component&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kwargs2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># e.g.: opacity=0.4</span>
                <span class="n">kwargs2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sele&#39;</span><span class="p">:</span> <span class="n">selection</span><span class="p">}}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">repr_type</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs2</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span>
        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;component_index&#39;</span><span class="p">:</span> <span class="n">component</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;addRepresentation&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;compList&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                              <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                          <span class="p">],</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="NGLWidget.center_view"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.center_view">[docs]</a>    <span class="nd">@_deprecated</span><span class="p">(</span><span class="s2">&quot;DEPRECATED: Please use &#39;center&#39; method&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">center_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;alias of `center_view`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NGLWidget.center"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.center">[docs]</a>    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;center view for given atom selection</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        view.center_view(selection=&#39;1-4&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;autoView&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;compList&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">selection</span><span class="p">,</span> <span class="n">duration</span><span class="p">],</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;component_index&#39;</span><span class="p">:</span> <span class="n">component</span><span class="p">},</span>
                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;_image_data&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_on_render_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;update image data to widget_image</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        method name might be changed</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_widget_image</span><span class="o">.</span><span class="n">_b64value</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="NGLWidget.render_image"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.render_image">[docs]</a>    <span class="k">def</span> <span class="nf">render_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">factor</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                     <span class="n">antialias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;render and get image as ipywidgets.widget_image.Image</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int or None, default None</span>
<span class="sd">            if None, use current frame</span>
<span class="sd">            if specified, use this number.</span>
<span class="sd">        factor : int, default 4</span>
<span class="sd">            quality of the image, higher is better</span>
<span class="sd">        antialias : bool, default True</span>
<span class="sd">        trim : bool, default False</span>
<span class="sd">        transparent : bool, default False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">            # tell NGL to render send image data to notebook.</span>
<span class="sd">            view.render_image()</span>
<span class="sd">            </span>
<span class="sd">            # make sure to call `get_image` method</span>
<span class="sd">            view.get_image()</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        You need to call `render_image` and `get_image` in different notebook&#39;s Cells</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span>
                      <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">,</span>
                      <span class="n">trim</span><span class="o">=</span><span class="n">trim</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">)</span>
        <span class="n">iw</span> <span class="o">=</span> <span class="n">Image</span><span class="p">()</span>
        <span class="n">iw</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;99%&#39;</span>  <span class="c1"># avoid ugly scroll bar on notebook.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;_exportImage&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">iw</span><span class="o">.</span><span class="n">model_id</span><span class="p">],</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="c1"># iw.value will be updated later after frontend send the image_data back.</span>
        <span class="k">return</span> <span class="n">iw</span></div>

<div class="viewcode-block" id="NGLWidget.download_image"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.download_image">[docs]</a>    <span class="k">def</span> <span class="nf">download_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;screenshot.png&#39;</span><span class="p">,</span>
                       <span class="n">factor</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">antialias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;render and download scene at current frame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, default &#39;screenshot.png&#39;</span>
<span class="sd">        factor : int, default 4</span>
<span class="sd">            quality of the image, higher is better</span>
<span class="sd">        antialias : bool, default True</span>
<span class="sd">        trim : bool, default False</span>
<span class="sd">        transparent : bool, default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span>
                      <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">,</span>
                      <span class="n">trim</span><span class="o">=</span><span class="n">trim</span><span class="p">,</span>
                      <span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;_downloadImage&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                              <span class="n">filename</span><span class="p">,</span>
                          <span class="p">],</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="n">params</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_ngl_handle_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">buffers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;store message sent from Javascript.</span>

<span class="sd">        How? use view.on_msg(get_msg)</span>

<span class="sd">        Notes: message format should be {&#39;type&#39;: type, &#39;data&#39;: data}</span>
<span class="sd">        _ngl_handle_msg will call appropriate function to handle message &quot;type&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_msg</span> <span class="o">=</span> <span class="n">msg</span>

        <span class="n">msg_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;request_frame&#39;</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">step</span>
            <span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frame</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;updateIDs&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_view_id</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;removeComponent&#39;</span><span class="p">:</span>
            <span class="n">cindex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">cindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;repr_parameters&#39;</span><span class="p">:</span>
            <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sele&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1"># json change True to true</span>
            <span class="n">data_dict_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">)</span>
            <span class="n">data_dict_json</span> <span class="o">=</span> <span class="n">data_dict_json</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;null&quot;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># TODO: refactor</span>
                <span class="n">repr_name_text</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_name_text&#39;</span><span class="p">)</span>
                <span class="n">repr_selection</span> <span class="o">=</span> <span class="n">widget_utils</span><span class="o">.</span><span class="n">get_widget_by_name</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">widget_repr</span><span class="p">,</span> <span class="s1">&#39;repr_selection&#39;</span><span class="p">)</span>
                <span class="n">repr_name_text</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">repr_selection</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">selection</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;request_loaded&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
                <span class="c1"># trick to trigger observe loaded</span>
                <span class="c1"># so two viewers can have the same representations</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;request_repr_dict&#39;</span><span class="p">:</span>
            <span class="c1"># update _repr_dict will trigger other things</span>
            <span class="c1"># see _handle_repr_dict_changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_repr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;stage_parameters&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_full_stage_parameters</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;async_message&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ok&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s1">&#39;image_data&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image_data</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
            <span class="n">Widget</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_image_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_request_repr_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">repr_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;requestReprParameters&#39;</span><span class="p">,</span>
                              <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                              <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">component</span><span class="p">,</span> <span class="n">repr_index</span><span class="p">])</span>

<div class="viewcode-block" id="NGLWidget.add_structure"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.add_structure">[docs]</a>    <span class="k">def</span> <span class="nf">add_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add structure to view</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure : nglview.Structure object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; view.add_trajectory(traj0) # doctest: +SKIP</span>
<span class="sd">        ... view.add_trajectory(traj1)</span>
<span class="sd">        ... # then add Structure</span>
<span class="sd">        ... view.add_structure(s)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        nglview.NGLWidget.add_component</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">structure</span><span class="si">}</span><span class="s1"> is not an instance of Structure&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_view</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_component_auto_completion</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="NGLWidget.add_trajectory"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.add_trajectory">[docs]</a>    <span class="k">def</span> <span class="nf">add_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add new trajectory to `view`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trajectory: nglview.Trajectory or its derived class or</span>
<span class="sd">            a supported object, eg pytraj.Trajectory-like,</span>
<span class="sd">            mdtraj.Trajectory, MDAnalysis objects, etc</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        nglview.NGLWidget.add_component</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import nglview as nv, pytraj as pt</span>
<span class="sd">        &gt;&gt;&gt; traj = pt.load(nv.datafiles.TRR, nv.datafiles.PDB)</span>
<span class="sd">        &gt;&gt;&gt; view = nv.show_pytraj(traj)</span>
<span class="sd">        &gt;&gt;&gt; # show view first</span>
<span class="sd">        &gt;&gt;&gt; view # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; # add new Trajectory</span>
<span class="sd">        &gt;&gt;&gt; traj2 = pt.datafiles.load_tz2()</span>
<span class="sd">        &gt;&gt;&gt; c = view.add_trajectory(traj2)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">backends</span> <span class="o">=</span> <span class="n">BACKENDS</span>

        <span class="n">package_name</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">backends</span><span class="p">:</span>
            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">backends</span><span class="p">[</span><span class="n">package_name</span><span class="p">](</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">trajectory</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="s1">&#39;shown&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_max_frame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_component_auto_completion</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="NGLWidget.add_pdbid"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.add_pdbid">[docs]</a>    <span class="k">def</span> <span class="nf">add_pdbid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add new Structure view by fetching pdb id from rcsb</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import nglview</span>
<span class="sd">        &gt;&gt;&gt; view = nglview.NGLWidget()</span>
<span class="sd">        &gt;&gt;&gt; c = view.add_pdbid(&#39;1tsu&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # which is equal to </span>
<span class="sd">        &gt;&gt;&gt; # view.add_component(&#39;rcsb://1tsu.pdb&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rcsb://</span><span class="si">{</span><span class="n">pdbid</span><span class="si">}</span><span class="s1">.pdb&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NGLWidget.add_component"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.add_component">[docs]</a>    <span class="k">def</span> <span class="nf">add_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add component from file/trajectory/struture</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str or Trajectory or Structure or their derived class or url</span>
<span class="sd">        **kwargs : additional arguments, optional</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import nglview</span>
<span class="sd">        &gt;&gt;&gt; view = nglview.NGLWidget()</span>
<span class="sd">        &gt;&gt;&gt; view # doctest: +SKIP</span>
<span class="sd">        ... filename = &#39;somefile.ccp4&#39;</span>
<span class="sd">        ... view.add_component(filename)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If you want to load binary file such as density data, mmtf format, it is</span>
<span class="sd">        faster to load file from current or subfolder.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># if passed a supported object, convert &quot;filename&quot; to nglview.Trajectory</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">package_name</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="c1"># string filename</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">BACKENDS</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">BACKENDS</span><span class="p">[</span><span class="n">package_name</span><span class="p">](</span><span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># assign an ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_component_auto_completion</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : nglview.Structure or any object having &#39;get_structure_string&#39; method or</span>
<span class="sd">              string buffer (open(fn).read())</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">kwargs2</span> <span class="o">=</span> <span class="n">_camelize_dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">is_url</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">is_url</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="n">is_url</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s1">&#39;defaultRepresentation&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs2</span><span class="p">:</span>
            <span class="n">kwargs2</span><span class="p">[</span><span class="s1">&#39;defaultRepresentation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_url</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;get_structure_string&#39;</span><span class="p">):</span>
                <span class="n">blob</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_structure_string</span><span class="p">()</span>
                <span class="n">kwargs2</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">ext</span>
                <span class="n">passing_buffer</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">binary</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fh</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span>
                                 <span class="n">ext</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ext&#39;</span><span class="p">),</span>
                                 <span class="n">compressed</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;compressed&#39;</span><span class="p">))</span>
                <span class="c1"># assume passing string</span>
                <span class="n">blob</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">passing_buffer</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">fh</span><span class="o">.</span><span class="n">use_filename</span>

                <span class="k">if</span> <span class="n">fh</span><span class="o">.</span><span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">passing_buffer</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must provide extension&#39;</span><span class="p">)</span>

                <span class="n">kwargs2</span><span class="p">[</span><span class="s1">&#39;ext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">ext</span>
                <span class="n">binary</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">is_binary</span>
                <span class="n">use_filename</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">use_filename</span>

            <span class="k">if</span> <span class="n">binary</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">use_filename</span><span class="p">:</span>
                <span class="c1"># send base64</span>
                <span class="n">blob</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="n">blob_type</span> <span class="o">=</span> <span class="s1">&#39;blob&#39;</span> <span class="k">if</span> <span class="n">passing_buffer</span> <span class="k">else</span> <span class="s1">&#39;path&#39;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">blob_type</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">blob</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary</span><span class="p">}]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># is_url</span>
            <span class="n">blob_type</span> <span class="o">=</span> <span class="s1">&#39;url&#39;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">blob_type</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}]</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">kwargs2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;loadFile&quot;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Stage&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                          <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs2</span><span class="p">)</span>

<div class="viewcode-block" id="NGLWidget.remove_component"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.remove_component">[docs]</a>    <span class="k">def</span> <span class="nf">remove_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;remove component by its uuid.</span>
<span class="sd">        If isinstance(c, ComponentViewer), `c` won&#39;t be associated with `self`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        c : Union[int, ComponentViewer]</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; c0 = view.add_trajectory(traj0) # doctest: +SKIP</span>
<span class="sd">        ... c1 = view.add_trajectory(traj1)</span>
<span class="sd">        ... c2 = view.add_struture(structure)</span>
<span class="sd">        ... # remove last component</span>
<span class="sd">        ... view.remove_component(c2)</span>
<span class="sd">        ... assert c2._view is None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ComponentViewer</span><span class="p">):</span>
            <span class="n">component_id</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">id</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">component_id</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_component_auto_completion</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">traj</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">component_id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
        <span class="n">component_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">component_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">component_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">component_index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;removeComponent&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Stage&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                              <span class="n">component_index</span><span class="p">,</span>
                          <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_component_auto_completion</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_dry_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_dry_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_remote_call_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">method_name</span><span class="p">,</span>
                             <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                             <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">other_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;call NGL&#39;s methods from Python.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method_name : str</span>
<span class="sd">        target : str, {&#39;Stage&#39;, &#39;Viewer&#39;, &#39;compList&#39;, &#39;StructureComponent&#39;}</span>
<span class="sd">        args : list</span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            if target is &#39;compList&#39;, &quot;component_index&quot; could be passed</span>
<span class="sd">            to specify which component will call the method.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        view._remote_call(&#39;loadFile&#39;, args=[&#39;1L2Y.pdb&#39;],</span>
<span class="sd">                          target=&#39;Stage&#39;, kwargs={&#39;defaultRepresentation&#39;: True})</span>

<span class="sd">        # perform autoView for 1st component</span>
<span class="sd">        # JS code</span>
<span class="sd">        # component = Stage.compList[1];</span>
<span class="sd">        # component.autoView(&#39;*&#39;, 200)</span>

<span class="sd">        # python</span>
<span class="sd">        view._remote_call(&#39;autoView&#39;,</span>
<span class="sd">                          target=&#39;component&#39;,</span>
<span class="sd">                          args=[&#39;*&#39;, 200],</span>
<span class="sd">                          kwargs={&#39;component_index&#39;: 1})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: _camelize_dict here?</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">args</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">kwargs</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s1">&#39;component_index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;component_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;component_index&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;repr_index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;repr_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;repr_index&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;default&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;defaultRepresentation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>

        <span class="c1"># Color handling</span>
        <span class="n">reconstruc_color_scheme</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                            <span class="n">color</span><span class="o">.</span><span class="n">_ColorScheme</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="c1"># overite `color`</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="n">reconstruc_color_scheme</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;colorScheme&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;volume&#39;</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;colorVolume&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorVolume&#39;</span><span class="p">],</span> <span class="n">ComponentViewer</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorVolume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_index</span>

        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;call_method&#39;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;reconstruc_color_scheme&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reconstruc_color_scheme</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">if</span> <span class="n">other_kwargs</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">_trim_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">):</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[:]</span>

        <span class="n">remove_comps</span> <span class="o">=</span> <span class="p">[(</span><span class="n">index</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;removeComponent&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">remove_comps</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">messages</span>

        <span class="n">load_comps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;loadFile&#39;</span><span class="p">,</span> <span class="s1">&#39;addShape&#39;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">messages_rm</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">remove_comps</span><span class="p">]</span>
        <span class="n">messages_rm</span> <span class="o">+=</span> <span class="p">[</span><span class="n">load_comps</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">remove_comps</span><span class="p">]</span>
        <span class="n">messages_rm</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">messages_rm</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">msg</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">messages_rm</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_remote_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">method_name</span><span class="p">,</span>
                     <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                     <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">other_kwargs</span><span class="p">):</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_remote_call_msg</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span>
                                        <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                                        <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                                        <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">other_kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">):</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">callback</span><span class="o">.</span><span class="n">_method_name</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="n">callback</span><span class="o">.</span><span class="n">_ngl_msg</span> <span class="o">=</span> <span class="n">msg</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call_thread</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># send later</span>
            <span class="c1"># all callbacks will be called right after widget is loaded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_displayed_callbacks_before_loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">callback</span><span class="o">.</span><span class="n">_method_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_EXCLUDED_CALLBACK_AFTER_FIRING</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="ow">not</span> <span class="n">other_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fire_once&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="n">archive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_msg_archive</span><span class="p">[:]</span>
            <span class="n">archive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_msg_archive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trim_message</span><span class="p">(</span><span class="n">archive</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_traj_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itsid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return nglview.Trajectory or its derived class object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">traj</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">itsid</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">traj</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="NGLWidget.hide"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.hide">[docs]</a>    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set invisibility for given component/struture/trajectory (by their indices)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">traj_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">traj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">comp_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">comp_id</span> <span class="ow">in</span> <span class="n">traj_ids</span><span class="p">:</span>
                <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_traj_by_id</span><span class="p">(</span><span class="n">comp_id</span><span class="p">)</span>
                <span class="n">traj</span><span class="o">.</span><span class="n">shown</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setVisibility&quot;</span><span class="p">,</span>
                              <span class="n">target</span><span class="o">=</span><span class="s1">&#39;compList&#39;</span><span class="p">,</span>
                              <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                                  <span class="kc">False</span><span class="p">,</span>
                              <span class="p">],</span>
                              <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;component_index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">})</span></div>

<div class="viewcode-block" id="NGLWidget.show"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shortcut of `show_only`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_only</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NGLWidget.show_only"><a class="viewcode-back" href="../../api.html#nglview.widget.NGLWidget.show_only">[docs]</a>    <span class="k">def</span> <span class="nf">show_only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set visibility for given components (by their indices)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indices : {&#39;all&#39;, array-like}, component index, default &#39;all&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">traj_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">traj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">indices</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">indices_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices_</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">comp_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">comp_id</span> <span class="ow">in</span> <span class="n">traj_ids</span><span class="p">:</span>
                <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_traj_by_id</span><span class="p">(</span><span class="n">comp_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">traj</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices_</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="kc">True</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">traj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">traj</span><span class="o">.</span><span class="n">shown</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="kc">False</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">traj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">traj</span><span class="o">.</span><span class="n">shown</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s2">&quot;setVisibility&quot;</span><span class="p">,</span>
                              <span class="n">target</span><span class="o">=</span><span class="s1">&#39;compList&#39;</span><span class="p">,</span>
                              <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                              <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;component_index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">},</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_js_console</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_full_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;parameters&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_display_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;for testing</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
        <span class="n">im_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">display</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">im_bytes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clear_component_auto_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;component_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_js_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_js_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_call</span><span class="p">(</span><span class="s1">&#39;executeCode&#39;</span><span class="p">,</span>
                          <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Widget&#39;</span><span class="p">,</span>
                          <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">code</span><span class="p">],</span>
                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_component_auto_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">trajids</span> <span class="o">=</span> <span class="p">[</span><span class="n">traj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajlist</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">cid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">):</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ComponentViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;component_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">trajids</span><span class="p">:</span>
                <span class="n">traj_name</span> <span class="o">=</span> <span class="s1">&#39;trajectory_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trajids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traj_name</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return ComponentViewer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">postive_index</span> <span class="o">=</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">get_positive_index</span><span class="p">(</span>
            <span class="n">index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ComponentViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">[</span><span class="n">postive_index</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return ComponentViewer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ngl_component_ids</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<span class="k">class</span> <span class="nc">Fullscreen</span><span class="p">(</span><span class="n">DOMWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;EXPERIMENTAL</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_view_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;FullscreenView&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_view_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;nglview-js-widgets&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_view_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">__frontend_version__</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_model_name</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;FullscreenModel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_model_module</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;nglview-js-widgets&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_model_module_version</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">__frontend_version__</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">_is_fullscreen</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">views</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_views</span> <span class="o">=</span> <span class="n">views</span>

    <span class="k">def</span> <span class="nf">fullscreen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_js</span><span class="p">(</span><span class="s2">&quot;this.fullscreen(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_js</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;executeCode&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="s1">&#39;_is_fullscreen&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fullscreen_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">change</span><span class="o">.</span><span class="n">new</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_target</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="s1">&#39;300px&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_resize</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">handle_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">handle_resize</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NGLView 2.7.7+0.gd41dfb9.dirty documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">nglview.widget</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Alexander Rose, Hai Nguyen.
      Last updated on Dec 22, 2020.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.0.
    </div>
  </body>
</html>